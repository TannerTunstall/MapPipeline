# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is an automatically updating KML file repository hosted on GitHub Pages. KML files are fetched/updated hourly via GitHub Actions and served through direct URLs for import into external software.

**Key Components:**
- **Frontend**: Static HTML/CSS/JS site (`index.html`, `styles.css`, `script.js`)
- **KML Storage**: Files stored in `kmls/` directory, served via GitHub raw URLs
- **Automation**: GitHub Actions workflow (`.github/workflows/update-kml.yml`) runs hourly
- **Update Scripts**: Node.js scripts in `scripts/` directory handle fetching and manifest generation

## Architecture

### URL Structure for KML Files
KML files must be accessible via direct URLs in this format:
```
https://raw.githubusercontent.com/USERNAME/REPO_NAME/main/kmls/filename.kml
```

This allows external software to import KML files directly via URL.

### Update Flow
1. GitHub Action triggers (hourly via cron or manual dispatch)
2. `scripts/update-kml.js` fetches/generates new KML files → writes to `kmls/`
3. `scripts/generate-manifest.js` scans `kmls/` → creates `kml-manifest.json`
4. Changes are committed and pushed to the repository
5. GitHub Pages serves updated files immediately (no rebuild needed)

### Frontend Architecture
- `index.html`: Main page structure
- `styles.css`: Dark theme styling with responsive design
- `script.js`: Loads `kml-manifest.json` and displays files with search/filter functionality
- No build process required - pure HTML/CSS/JS

## Common Commands

### Testing Update Scripts Locally
```bash
# Update KML files
node scripts/update-kml.js

# Generate manifest
node scripts/generate-manifest.js
```

### Manual Workflow Trigger
Trigger the GitHub Action manually:
1. Go to "Actions" tab in GitHub
2. Select "Update KML Files" workflow
3. Click "Run workflow"

### Local Development Server
```bash
# Python
python -m http.server 8000

# Node.js (if available)
npx http-server
```

Then open http://localhost:8000

## Configuration

### Adding KML Data Sources
Edit `scripts/update-kml.js` to add your KML sources. The `fetchKML()` helper function is provided:

```javascript
// Fetch from external URL
await fetchKML('https://example.com/data.kml', 'output-name.kml');
```

For other data sources (APIs, databases, generated data), add custom logic in the `updateKMLFiles()` function.

### Repository Configuration
Update these values in `script.js`:
```javascript
const REPO_OWNER = 'YOUR_GITHUB_USERNAME';
const REPO_NAME = 'YOUR_REPO_NAME';
```

## File Manifest System

`kml-manifest.json` is auto-generated and contains:
```json
{
  "lastUpdate": "ISO timestamp",
  "files": [
    {
      "name": "filename.kml",
      "url": "full GitHub raw URL",
      "size": 12345,
      "updated": "ISO timestamp"
    }
  ]
}
```

The frontend fetches this manifest to display available files. Never edit this file manually - it's regenerated by `scripts/generate-manifest.js`.

## GitHub Actions Permissions

The workflow requires `contents: write` permission to commit updated KML files. This is configured in `.github/workflows/update-kml.yml`.

## Cost Considerations

This setup is completely free:
- **GitHub Pages**: Free unlimited bandwidth
- **GitHub Actions**: 2,000 minutes/month free (hourly cron uses ~1 minute/run = ~720 minutes/month)
- **Repository storage**: Free for public repos

## Styling Guidelines

The site uses a dark theme with these design principles:
- Dark blue-gray background (`#0f172a`)
- Blue accent color (`#2563eb`) for primary actions
- Responsive design with mobile breakpoints at 768px
- Smooth transitions and hover effects
- Modern sans-serif font stack

When modifying styles, maintain consistency with existing CSS variables in `:root`.

## Adding New Features

When adding features to the frontend:
1. Keep the site static (no build process)
2. Maintain compatibility with the manifest format
3. Ensure KML file URLs remain direct GitHub raw links
4. Test search/filter functionality with new changes

When modifying update scripts:
1. Ensure output files are written to `kmls/` directory
2. All files must have `.kml` extension to appear in manifest
3. Handle errors gracefully (failed fetch shouldn't break entire update)
4. Log progress to console for GitHub Actions logs
